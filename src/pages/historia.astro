---
import Layout from '../layouts/Layout.astro';
import Navbar from '../layouts/Navbar.astro';
import Footer from '../layouts/Footer.astro';
import { historyEvents } from '../data/history'; // <--- Importamos los datos
---

<Layout title="Nuestra Historia - LAGAWARDS">
  <Navbar />
  
  <main class="pt-24 min-h-screen text-white relative overflow-hidden bg-[#020205] perspective-container">
    
    <div class="fixed inset-0 z-0 pointer-events-none">
        <div class="absolute inset-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_110%)] animate-grid-flow"></div>
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-600/20 rounded-full blur-[128px] animate-pulse-slow"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-blue-600/20 rounded-full blur-[128px] animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <div class="container mx-auto px-4 md:px-6 py-20 relative z-10">
      
      <div class="text-center mb-32 relative">
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-32 bg-purple-500/20 blur-[100px] -z-10"></div>
        <span class="inline-block py-1 px-4 rounded-full bg-white/5 border border-white/20 text-purple-300 text-xs font-mono font-bold mb-6 uppercase tracking-[0.5em] animate-fade-in-up">
            Timeline_V2.0
        </span>
        <h1 class="text-6xl md:text-8xl font-black font-orbitron text-transparent bg-clip-text bg-gradient-to-b from-white via-white to-white/50 mb-6 filter drop-shadow-[0_0_30px_rgba(168,85,247,0.5)] animate-glitch">
          LEGADO <span class="text-purple-500">LAG</span>
        </h1>
        <p class="text-gray-400 text-lg md:text-xl max-w-2xl mx-auto leading-relaxed font-light">
            Un viaje a travÃ©s de los bugs, los gritos y la gloria.
        </p>
      </div>

      <div class="relative max-w-6xl mx-auto">
        
        <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-1 md:-translate-x-1/2 bg-white/10 rounded-full overflow-hidden">
            <div id="timeline-progress" class="w-full bg-gradient-to-b from-purple-500 via-blue-500 to-red-500 h-0 shadow-[0_0_20px_rgba(168,85,247,1)] transition-all duration-100 ease-out"></div>
        </div>

        <div class="space-y-24 md:space-y-32 pb-32">
          {historyEvents.map((evt, index) => (
            <div class={`timeline-row flex flex-col md:flex-row items-center w-full ${evt.side === 'left' ? 'md:flex-row-reverse' : ''} group perspective-1000`}>
              
              <div class="hidden md:block w-1/2"></div>

              <div class="absolute left-4 md:left-1/2 w-12 h-12 -translate-x-1/2 flex items-center justify-center z-20">
                <div class="w-4 h-4 bg-[#050505] border-2 border-gray-600 rounded-full group-hover:border-white group-hover:scale-150 transition-all duration-500 relative">
                    <div class={`absolute inset-0 bg-gradient-to-r ${evt.color} rounded-full opacity-0 group-hover:opacity-100 animate-ping`}></div>
                </div>
              </div>

              <div class="w-full md:w-1/2 pl-16 md:pl-0 md:px-16">
                <a 
                    href={evt.link || "#"}
                    target={evt.link && evt.link !== "#" ? "_blank" : "_self"}
                    class="tilt-card block relative transform-gpu transition-all duration-500 cursor-pointer hover:scale-[1.02]"
                    data-tilt
                    data-tilt-max="15"
                    data-tilt-speed="400"
                    data-tilt-glare
                    data-tilt-max-glare="0.2"
                >
                    <h2 class="absolute -top-10 -left-4 text-8xl font-black text-white/5 select-none font-orbitron z-0 group-hover:text-white/10 transition-colors duration-500">
                        {evt.year}
                    </h2>

                    <div class={`
                        relative z-10 bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/10 p-8 rounded-3xl 
                        overflow-hidden shadow-2xl group-hover:shadow-[0_0_50px_rgba(100,100,255,0.2)]
                        transition-all duration-300
                    `}>
                        {evt.image && (
                            <div class="absolute inset-0 z-0">
                                <img 
                                    src={evt.image} 
                                    alt={`Fondo ${evt.title}`} 
                                    class="w-full h-full object-cover opacity-10 group-hover:opacity-70 transition-opacity duration-500 grayscale group-hover:grayscale-0"
                                />
                                <div class="absolute inset-0 bg-black/60"></div>
                            </div>
                        )}

                        <div class={`absolute inset-0 bg-gradient-to-br ${evt.color} opacity-0 group-hover:opacity-20 transition-opacity duration-500 z-10 pointer-events-none`}></div>
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-white/50 to-transparent -translate-x-full group-hover:animate-shimmer z-20"></div>

                        <div class="relative z-20 flex items-start gap-6">
                            <div class={`
                                flex-shrink-0 
                                w-16 h-16 rounded-2xl bg-gradient-to-br ${evt.color} 
                                flex items-center justify-center text-3xl shadow-lg transform group-hover:rotate-12 transition-transform duration-500
                            `}>
                                {evt.icon}
                            </div>

                            <div>
                                <span class={`text-xs font-bold uppercase tracking-widest text-transparent bg-clip-text bg-gradient-to-r ${evt.color} mb-1 block`}>
                                    {evt.subtitle}
                                </span>
                                <h3 class="text-3xl font-bold text-white font-orbitron mb-3 leading-tight group-hover:text-purple-300 transition-colors">
                                    {evt.title}
                                </h3>
                                <p class="text-gray-400 text-sm leading-relaxed font-light">
                                    {evt.description}
                                </p>
                            </div>
                        </div>

                        <div class="absolute bottom-4 right-4 z-20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-x-2 group-hover:translate-x-0">
                            <svg class="w-5 h-5 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </div>

                        <div class="absolute top-4 right-4 flex gap-1 z-20">
                            <div class="w-1 h-1 bg-white/30 rounded-full"></div>
                            <div class="w-1 h-1 bg-white/30 rounded-full"></div>
                            <div class="w-1 h-1 bg-white/30 rounded-full"></div>
                        </div>
                        
                    </div>
                </a>
              </div>

            </div>
          ))}
        </div>

        <div class="flex justify-center mt-20 relative z-10 pb-20">
             <div class="group cursor-pointer px-10 py-5 bg-[#111] border border-white/20 rounded-full text-center hover:border-purple-500 transition-all duration-300 hover:scale-105 hover:shadow-[0_0_30px_rgba(168,85,247,0.4)]">
                 <p class="font-orbitron text-sm text-gray-400 uppercase tracking-widest group-hover:text-white transition-colors">
                    ðŸš€ El futuro continÃºa...
                </p>
             </div>
        </div>

      </div>
    </div>
  </main>
  <Footer />
</Layout>

<style>
    /* ... (Mismos estilos que tenÃ­as) ... */
    @keyframes gridFlow {
        0% { background-position: 0 0; }
        100% { background-position: 4rem 4rem; }
    }
    .animate-grid-flow {
        animation: gridFlow 20s linear infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    .group:hover .group-hover\:animate-shimmer {
        animation: shimmer 1.5s infinite;
    }

    .timeline-row {
        opacity: 0;
        transform: translateY(100px) scale(0.9);
        transition: all 1s cubic-bezier(0.17, 0.55, 0.55, 1);
        filter: blur(10px);
    }
    .timeline-row.active {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
</style>

<script>
    import VanillaTilt from 'vanilla-tilt';
    document.addEventListener('astro:page-load', () => {
        
        // 1. INICIALIZAR TILT (Efecto 3D)
        const cards = document.querySelectorAll('.tilt-card');
        VanillaTilt.init(Array.from(cards) as HTMLElement[], {
            max: 10,
            speed: 400,
            glare: true,
            "max-glare": 0.2,
            scale: 1.02
        });

        // 2. BARRA DE PROGRESO LÃSER
        const updateProgress = () => {
            const timeline = document.querySelector('.relative.max-w-6xl');
            const progressBar = document.getElementById('timeline-progress');
            
            if (timeline && progressBar) {
                const rect = timeline.getBoundingClientRect();
                const windowHeight = window.innerHeight;
                const start = rect.top;
                const end = rect.bottom;
                const totalHeight = end - start;
                
                let progress = (windowHeight / 2 - start) / (totalHeight - windowHeight);
                progress = Math.max(0, Math.min(1, progress));
                progressBar.style.height = `${progress * 100}%`;
            }
        };

        window.addEventListener('scroll', updateProgress);

        // 3. SCROLL REVEAL (ApariciÃ³n mÃ¡gica)
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: "0px 0px -100px 0px"
        });

        document.querySelectorAll('.timeline-row').forEach(row => {
            observer.observe(row);
        });
    });
</script>