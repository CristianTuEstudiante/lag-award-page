---
import Layout from '../layouts/Layout.astro';
import Navbar from '../layouts/Navbar.astro';
import Footer from '../layouts/Footer.astro';

// --- CONFIGURACI√ìN DEL EVENTO ---
// Formato: A√ëO-MES-D√çA T HORA:MINUTO:SEGUNDO
<<<<<<< HEAD
const TARGET_DATE = new Date("2025-12-13T20:00:00").getTime(); 
=======
const TARGET_DATE = new Date("2025-12-13T00:30:00").getTime(); 
>>>>>>> origin/main
const STREAM_ID = "sLfmFxlv7LY"; // Reemplaza con el ID real del stream
---

<Layout title="Gran Gala Final - LAGAWARDS">
  <Navbar />
  
  <main 
    id="premiacion-container"
    data-target-date={TARGET_DATE}
    data-stream-id={STREAM_ID}
    class="pt-24 min-h-screen text-white relative overflow-hidden bg-[#050505]"
  >
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-900/20 via-black to-black -z-10"></div>
    <div class="absolute top-0 left-0 w-full h-full bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:4rem_4rem] pointer-events-none"></div>

    <div class="container mx-auto px-4 md:px-6 py-12 flex flex-col items-center">
      
      <div class="text-center mb-12 animate-fade-in">
        <div class="inline-flex items-center gap-2 px-4 py-1 rounded-full bg-red-600/10 border border-red-500/30 mb-6">
            <span class="relative flex h-3 w-3">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
            </span>
            <span class="text-red-400 font-mono text-sm font-bold tracking-widest">EVENTO EN VIVO</span>
        </div>

        <h1 class="text-5xl md:text-7xl font-black font-orbitron text-white mb-4 tracking-tighter">
          GRAN GALA <span class="text-transparent bg-clip-text bg-linear-to-r from-yellow-400 to-orange-600">FINAL</span>
        </h1>
        
        <p class="text-2xl md:text-3xl text-gray-300 font-bold font-orbitron">
          12 DE DICIEMBRE <span class="text-purple-500 mx-2">‚Ä¢</span> 22:00 HS
        </p>
      </div>

      <div id="countdown-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 mb-16 w-full max-w-4xl">
        <div class="bg-[#111] border border-white/10 rounded-2xl p-6 text-center relative group overflow-hidden">
            <span id="d" class="block text-5xl md:text-7xl font-black font-orbitron text-white mb-2">00</span>
            <span class="text-gray-500 text-xs font-bold uppercase tracking-[0.3em]">D√≠as</span>
        </div>
        <div class="bg-[#111] border border-white/10 rounded-2xl p-6 text-center relative group overflow-hidden">
            <span id="h" class="block text-5xl md:text-7xl font-black font-orbitron text-white mb-2">00</span>
            <span class="text-gray-500 text-xs font-bold uppercase tracking-[0.3em]">Horas</span>
        </div>
        <div class="bg-[#111] border border-white/10 rounded-2xl p-6 text-center relative group overflow-hidden">
            <span id="m" class="block text-5xl md:text-7xl font-black font-orbitron text-white mb-2">00</span>
            <span class="text-gray-500 text-xs font-bold uppercase tracking-[0.3em]">Minutos</span>
        </div>
        <div class="bg-[#111] border border-white/10 rounded-2xl p-6 text-center relative group overflow-hidden border-red-500/30 shadow-[0_0_30px_rgba(220,38,38,0.1)]">
            <span id="s" class="block text-5xl md:text-7xl font-black font-orbitron text-red-500 mb-2">00</span>
            <span class="text-red-400/70 text-xs font-bold uppercase tracking-[0.3em]">Segundos</span>
        </div>
      </div>

      <div class="w-full max-w-[1800px] relative group mb-12">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 bg-[#0a0a0a] p-2 md:p-4 rounded-3xl border border-white/10 shadow-2xl">
            
            <div class="lg:col-span-2 relative rounded-xl overflow-hidden bg-black aspect-video lg:aspect-auto lg:h-[75vh]">
                <div id="stream-placeholder" class="absolute inset-0 z-20 bg-black flex flex-col items-center justify-center transition-opacity duration-1000">
                    <div class="w-24 h-24 relative mb-8">
                        <div class="absolute inset-0 border-4 border-red-600/20 rounded-full animate-ping"></div>
                        <div class="absolute inset-0 border-4 border-t-red-500 rounded-full animate-spin"></div>
                        <div class="absolute inset-0 flex items-center justify-center font-bold text-red-500 text-xs">LIVE</div>
                    </div>
                    <h3 class="text-3xl font-black font-orbitron text-white mb-2 text-center">SINTONIZANDO SE√ëAL</h3>
                    <p class="text-gray-500 font-mono text-sm text-center px-4">El stream comenzar√° autom√°ticamente cuando el contador llegue a cero.</p>
                </div>

                <iframe 
                    class="w-full h-full"
                    src={`https://www.youtube.com/embed/${STREAM_ID}?autoplay=1&mute=1&rel=0&modestbranding=1`} 
                    title="LAG AWARDS LIVE" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            </div>

            <div class="lg:col-span-1 bg-[#111] rounded-xl overflow-hidden flex flex-col h-[600px] lg:h-auto border border-white/5 shadow-inner">
                <div class="bg-[#161616] p-4 border-b border-white/10 flex justify-between items-center">
                    <span class="font-bold text-gray-300 text-sm uppercase tracking-widest">Chat de la Comunidad</span>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-xs text-green-500 font-bold">EN VIVO</span>
                    </div>
                </div>
                
                <div id="chat-container" class="flex-1 bg-[#0a0a0a] relative">
                    <div class="absolute inset-0 flex items-center justify-center text-gray-600 text-xs">
                        Cargando chat...
                    </div>
                    <iframe id="live-chat-iframe" class="relative z-10 w-full h-full" frameborder="0"></iframe>
                </div>
            </div>

        </div>

        <div class="mt-8 flex flex-col md:flex-row justify-between items-center gap-6 px-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-2xl">üèÜ</div>
                <div>
                    <h3 class="font-bold text-white">LAG AWARDS 2025</h3>
                    <p class="text-sm text-gray-500">La noche m√°s importante del a√±o</p>
                </div>
            </div>
            <div class="flex gap-3">
                <a href={`https://youtube.com/watch?v=${STREAM_ID}`} target="_blank" class="px-8 py-3 bg-[#ff0000] hover:bg-[#cc0000] text-white font-bold rounded-lg transition-colors flex items-center gap-2 text-sm transform hover:scale-105">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
                    Abrir en YouTube
                </a>
            </div>
        </div>

      </div>

    </div>
  </main>
  <Footer />
</Layout>

<script>
  import confetti from 'canvas-confetti';

  document.addEventListener("astro:page-load", () => {
      // 1. LEER DATOS
      const container = document.getElementById('premiacion-container');
      if (!container) return;

      const targetDate = parseInt(container.dataset.targetDate || '0');
      const streamId = container.dataset.streamId || '';

      // 2. CHAT SETUP
      const setupChat = () => {
          const chatIframe = document.getElementById('live-chat-iframe');
          if (chatIframe && streamId) {
              const domain = window.location.hostname;
              chatIframe.src = `https://www.youtube.com/live_chat?v=${streamId}&embed_domain=${domain}`;
          }
      };

      // 3. COUNTDOWN
      let hasCelebrated = false;

      const countdown = () => {
          const now = new Date().getTime();
          const gap = targetDate - now;

          const elD = document.getElementById("d");
          const elH = document.getElementById("h");
          const elM = document.getElementById("m");
          const elS = document.getElementById("s");
          const placeholder = document.getElementById("stream-placeholder");

          if (gap < 0) {
              if(elD) elD.innerText = "00";
              if(elH) elH.innerText = "00";
              if(elM) elM.innerText = "00";
              if(elS) elS.innerText = "00";
              
              if(placeholder) {
                  placeholder.style.opacity = "0";
                  setTimeout(() => placeholder.style.display = "none", 1000);
              }

              if (!hasCelebrated) {
                  hasCelebrated = true;
                  const duration = 3000;
                  const end = Date.now() + duration;
                  (function frame() {
                      confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                      confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                      if (Date.now() < end) requestAnimationFrame(frame);
                  }());
              }
              return;
          }

          const second = 1000;
          const minute = second * 60;
          const hour = minute * 60;
          const day = hour * 24;

          const d = Math.floor(gap / day);
          const h = Math.floor((gap % day) / hour);
          const m = Math.floor((gap % hour) / minute);
          const s = Math.floor((gap % minute) / second);

          if(elD) elD.innerText = d < 10 ? "0" + d : d;
          if(elH) elH.innerText = h < 10 ? "0" + h : h;
          if(elM) elM.innerText = m < 10 ? "0" + m : m;
          if(elS) elS.innerText = s < 10 ? "0" + s : s;
      };

      setupChat();
      setInterval(countdown, 1000);
      countdown();
  });
</script>